{{ define "main" }}
<article>
    <h1>{{ .Title }}</h1>
    
    {{ if .Content }}
    <div class="content">
        {{ .Content }}
    </div>
    {{ end }}
    
    {{ if .Params.pdf }}
    <div class="pdf-container">
        {{ $pdfPath := .Params.pdf }}
        {{ $pdfFilename := index (split $pdfPath "/") -1 }}
        {{ $baseURL := strings.TrimSuffix "/" .Site.BaseURL }}
        {{ $absoluteURL := printf "%s%s" $baseURL $pdfPath }}
        {{ $relativeURL := $pdfPath | relURL }}
        
        <div style="border: 2px dashed #ddd; padding: 2rem; text-align: center; background: #f9f9f9; border-radius: 8px; margin: 2rem 0;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
            <h3 style="margin-bottom: 0.5rem;">PDF Document: {{ $pdfFilename }}</h3>
            <p style="color: #666; margin-bottom: 1.5rem;">Click the buttons below to view or download this document.</p>
            
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="{{ $relativeURL }}" target="_blank" class="pdf-download" style="text-decoration: none;">
                    üëÅÔ∏è View PDF
                </a>
                <button onclick="downloadPDF('{{ $absoluteURL }}', '{{ $pdfFilename }}')" class="pdf-download" style="border: none; cursor: pointer; font-size: inherit; font-family: inherit;">
                    ‚¨áÔ∏è Download PDF (JS)
                </button>
                <a href="{{ $relativeURL }}" download="{{ $pdfFilename }}" class="pdf-download" style="text-decoration: none;">
                    ‚¨áÔ∏è Download PDF (Direct)
                </a>
            </div>
        </div>
        
        <div style="margin-top: 2rem;">
            <object data="{{ $relativeURL }}" type="application/pdf" class="pdf-viewer" style="display: none;" id="pdf-object">
                <embed src="{{ $relativeURL }}" type="application/pdf" class="pdf-viewer" />
                <p>Your browser does not support PDFs. 
                <a href="{{ $relativeURL }}" target="_blank">Open in new tab</a> to view.</p>
            </object>
        </div>
        
        <div style="margin-top: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 4px;">
            <p style="margin: 0; font-size: 0.9em; color: #666;">
                <strong>Direct link:</strong> 
                <a href="{{ $absoluteURL }}" target="_blank" style="color: #667eea; word-break: break-all;">{{ $absoluteURL }}</a>
            </p>
        </div>
    </div>
    
    <script>
    function downloadPDF(url, filename) {
        console.log('Downloading PDF:', url, filename);
        
        // First, try using fetch with proper error handling
        fetch(url, {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache'
        })
            .then(response => {
                console.log('Fetch response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.blob();
            })
            .then(blob => {
                console.log('Blob created, size:', blob.size);
                if (blob.size === 0) {
                    throw new Error('Empty blob received');
                }
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(link.href);
                console.log('Download completed');
            })
            .catch(error => {
                console.error('Download failed:', error);
                console.log('Falling back to direct download link');
                // Fallback: create a link with download attribute
                const fallbackLink = document.createElement('a');
                fallbackLink.href = url;
                fallbackLink.download = filename;
                fallbackLink.target = '_blank';
                document.body.appendChild(fallbackLink);
                fallbackLink.click();
                document.body.removeChild(fallbackLink);
            });
    }
    </script>
    {{ end }}
</article>
{{ end }}

